<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Speech Trainer</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
    }
    .section {
      margin-bottom: 4rem;
    }
    #color-boxes, #object-image {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem auto;
    }
    .color-box {
      width: 100px;
      height: 100px;
      border: 2px solid #000;
    }
    img.object-img {
      max-width: 300px;
      height: auto;
      border: 2px solid #000;
    }
    .controls {
      margin-top: 1rem;
    }
    .score {
      font-size: 1.2rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Speech Trainer App</h1>

  <!-- Mode Switcher -->
  <div class="controls">
    <button onclick="setMode('colors')">üü¶ Color Retelling</button>
    <button onclick="setMode('objects')">üü© Object Recognition</button>
    <br>
    <label for="interval">Display Time (1‚Äì10 seconds):</label>
    <input type="number" id="interval" value="3" min="1" max="10" /> seconds
  </div>

  <!-- COLOR MODE -->
  <div id="color-section" class="section" style="display: none;">
    <h2>üé® Color Retelling</h2>
    <div id="color-boxes"></div>
    <div id="color-result" class="score"></div>
  </div>

  <!-- OBJECT MODE -->
  <div id="object-section" class="section" style="display: none;">
    <h2>üñºÔ∏è Object Recognition</h2>
    <div id="object-image"></div>
    <div id="object-result" class="score"></div>
    <div id="object-score" class="score"></div>
  </div>

  <script>
    const colors = ["red", "blue", "green", "yellow", "orange", "purple", "pink", "brown", "black", "white", "gray"];
    const objects = [
      { name: "broom", url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Broom.jpg/320px-Broom.jpg" },
      { name: "soil", url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Soil_Sample.jpg/320px-Soil_Sample.jpg" },
      { name: "pipeline", url: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Oil_pipeline_in_Minnesota_crop.jpg/320px-Oil_pipeline_in_Minnesota_crop.jpg" },
      { name: "scale", url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/Kitchen_scale_1.jpg/320px-Kitchen_scale_1.jpg" },
      { name: "seeds", url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Mixed_seeds.jpg/320px-Mixed_seeds.jpg" },
      { name: "continent", url: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Continents_map.png/320px-Continents_map.png" }
    ];

    let mode = "colors";
    let intervalId;
    let colorCurrent = [];
    let objectIndex = 0;
    let objectCorrect = 0;
    let objectFailed = 0;
    let objectSet = [];

    function setMode(selectedMode) {
      mode = selectedMode;
      clearInterval(intervalId);
      document.getElementById("color-section").style.display = mode === "colors" ? "block" : "none";
      document.getElementById("object-section").style.display = mode === "objects" ? "block" : "none";
      const seconds = Math.max(1, Math.min(10, parseInt(document.getElementById("interval").value)));
      if (mode === "colors") startColorMode(seconds);
      if (mode === "objects") startObjectMode(seconds);
    }

    // ---------- COLOR MODE ----------
    function startColorMode(seconds) {
      showColorBoxes();
      intervalId = setInterval(showColorBoxes, seconds * 1000);
    }

    function showColorBoxes() {
      const container = document.getElementById("color-boxes");
      container.innerHTML = "";
      colorCurrent = colors.sort(() => 0.5 - Math.random()).slice(0, 3);
      colorCurrent.forEach(color => {
        const box = document.createElement("div");
        box.className = "color-box";
        box.style.backgroundColor = color;
        container.appendChild(box);
      });
      startSpeechRecognition(colorCurrent, "color-result");
    }

    // ---------- OBJECT MODE ----------
    function startObjectMode(seconds) {
      objectSet = objects.sort(() => 0.5 - Math.random()).slice(0, 20);
      objectIndex = 0;
      objectCorrect = 0;
      objectFailed = 0;
      document.getElementById("object-score").innerText = "";
      showNextObject(seconds);
    }

    function showNextObject(seconds) {
      if (objectIndex >= objectSet.length) {
        alert("20 images done! Page will reload to start again.");
        location.reload();
        return;
      }
      const obj = objectSet[objectIndex];
      const container = document.getElementById("object-image");
      container.innerHTML = `<img src="${obj.url}" class="object-img" alt="${obj.name}" />`;
      startSpeechRecognition([obj.name], "object-result", true);

      setTimeout(() => {
        objectIndex++;
        showNextObject(seconds);
      }, seconds * 1000);
    }

    // ---------- SPEECH ----------
    function startSpeechRecognition(expectedWords, resultElementId, trackScore = false) {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const spoken = event.results[0][0].transcript.toLowerCase();
        const matched = expectedWords.filter(w => spoken.includes(w));
        document.getElementById(resultElementId).innerHTML = `You said: "${spoken}"<br>Matched: ${matched.join(", ")}`;

        if (trackScore) {
          if (matched.length > 0) objectCorrect++;
          else objectFailed++;
          document.getElementById("object-score").innerText = `‚úÖ Correct: ${objectCorrect} | ‚ùå Incorrect: ${objectFailed}`;
        }
      };

      recognition.onerror = (event) => {
        document.getElementById(resultElementId).textContent = `Error: ${event.error}`;
      };

      recognition.start();
    }
  </script>
</body>
</html>
